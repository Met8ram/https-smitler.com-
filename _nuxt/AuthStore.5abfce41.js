import{S as l,ak as h,u as i,al as g}from"./entry.0a96b526.js";const r={get:o("GET"),post:o("POST"),put:o("PUT"),delete:o("DELETE")};function o(t){return(e,s)=>{const a={method:t,headers:f(e)};return s&&(a.headers["Content-Type"]="application/json",a.body=JSON.stringify(s)),fetch(e,a).then(d)}}function f(t){const{token:e}=u(),s=!!e,a=t.startsWith("https://smitler.com/api");return s&&a?{Authorization:`Bearer ${e}`}:{}}function d(t){return t.text().then(e=>{const s=e&&JSON.parse(e);if(!t.ok){const{user:a,logout:c}=u();[401,403].includes(t.status)&&a&&c(),[500,400].includes(t.status)&&l.fire("Error",s.message,"error"),[404].includes(t.status);const p=s&&s.message||t.statusText;return Promise.reject(p)}return s})}const n="https://smitler.com/api/security",u=h("AuthStore",{state:()=>({token:"",user:{},returnUrl:null}),getters:{isLoggedIn:t=>!!t.token},actions:{async login(t,e){const s=await r.post(`${n}/login`,{login:t.value,password:e.value});this.user=s.user,this.token=s.access_token,i().$router.push(this.returnUrl||"/")},async logout(){this.user=null,this.token=null,i().$router.push("/security/login")},async register(t,e){return await r.post(`${n}/register`,{email:t,password:e})},async forgot(t){return await r.post(`${n}/reset`,{email:t})},async resetPassword(t,e){return await r.post(`${n}/reset`,{password1:t,password2:t,code:e})},async me(){const t=await r.get(`${n}/me`);this.user=t.user,this.token=t.access_token},async updateProfile(){const t=await r.post(`${n}/update-profile`,{user:this.user});return this.me(),t},async confirm(t){const e=await r.post(`${n}/confirm`,{code:t});return this.token=e.access_token,await this.me(),e},async connect(t){const e=await r.get(`${n}/connect?`+new URLSearchParams(t));return this.token=e.access_token,await this.me(),e}},persist:{storage:g.localStorage}});export{r as f,u};
